<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <link rel="stylesheet" href="../style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1. 缺失值处理 - lhh的美赛笔记</title>
    <style>
        /* 复刻网络爬虫笔记的经典高对比度样式 */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f4f7f9; color: #333; line-height: 1.6; }
        
        header { background-color: #2c3e50; color: white; padding: 60px 20px; text-align: center; margin-bottom: 40px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        
        .container { max-width: 900px; margin: 0 auto; padding: 0 20px; }
        .card { background: white; border-radius: 12px; padding: 30px; margin-bottom: 30px; box-shadow: 0 8px 20px rgba(0,0,0,0.05); }
        
        /* 蓝色装饰条标题 */
        .card h2 { color: #2563eb; font-size: 1.5rem; border-left: 5px solid #2563eb; padding-left: 15px; margin-bottom: 20px; }
        .card h3 { margin: 20px 0 10px; color: #1e293b; }

        .quote-box { background-color: #eff6ff; border-left: 4px solid #3b82f6; padding: 15px 20px; margin: 20px 0; color: #1e40af; font-style: italic; }
        
        pre { background-color: #1e1e1e; color: #d4d4d4; padding: 20px; border-radius: 10px; overflow-x: auto; font-family: 'Consolas', monospace; font-size: 14px; margin: 20px 0; }
        
        .img-box { text-align: center; margin: 25px 0; border: 1px solid #eee; padding: 10px; border-radius: 8px; }
        .img-box img { max-width: 100%; height: auto; border-radius: 4px; }
        .img-caption { color: #64748b; font-size: 0.85rem; margin-top: 8px; }

        .back-btn { display: inline-block; margin: 20px; padding: 10px 20px; background: #fff; color: #2c3e50; text-decoration: none; border-radius: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); font-size: 0.9rem; font-weight: bold; }
        .back-btn:hover { background: #2c3e50; color: white; }
    </style>
</head>
<body>

    <a href="../index.html" class="back-btn">← 返回索引</a>

    <header>
        <h1>1. 缺失值处理</h1>
        <p>数据预处理主要采用先填充缺失值再处理异常值的方法</p>
    </header>

    <div class="container">
        <!-- 理论部分 -->
        <div class="card">
            <h2>一、 核心概念</h2>
            <p><strong>缺失值处理（表格有空白或失效处）</strong></p>
            <p>主要有三种方法：</p>
            <h3>1. 均值填充</h3>
            <p>就是直接在空白处填上已有数据的平均值；</p>
            <p style="color: #666;">优：简单快速。缺：会缩小数据方差，使分布变“瘦”。</p>
            
            <h3>2. 中位数填充</h3>
            <p>就是直接填上中位数；</p>
            <p style="color: #666;">优：具有较强的鲁棒性，不受离群点影响。（人话：稳定性强）</p>
            
            <h3>3. KNN（K 近邻）填充</h3>
            <p>寻找与缺失样本最相似的 k 个邻居，取其均值。</p>
            <p style="color: #666;">优：考虑了变量间的内部逻辑。缺：计算开销大，需调用外部库。</p>
            
            <p style="margin-top: 20px; font-weight: bold; color: #d946ef;">注意：处理后需检查均值和方差是否发生剧烈偏移。</p>
        </div>

        <!-- 论文金句 -->
        <div class="card">
            <h2>二、 论文可以这样写</h2>
            <div class="quote-box">
                “考虑到数据分布的稳定性，我们初步采用了均值填充；同时为了验证鲁棒性，我们也对比了 KNN 填充的效果...”
            </div>
            <div class="quote-box">
                “为了增强模型的鲁棒性，我们采用了中位数而非均值来处理带有离群点的特征变量。”
            </div>
            <div class="quote-box">
                “灵敏度分析：我们分别测试了均值填充和 KNN 填充对后续模型预测准确率的影响，发现 KNN 填充显著提高了模型的鲁棒性，因此我们最终采纳了该方案。”
            </div>
        </div>

        <!-- 代码部分 -->
        <div class="card">
            <h2>三、 Python 完整实现代码</h2>
            
            <!-- 用 code-container 包裹按钮和 pre -->
            <div class="code-container">
                <button class="copy-btn" onclick="copyCode(this)">复制代码</button>
                <pre>
# 1.缺失值处理.py
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from sklearn.impute import KNNImputer


# 创建示例数据
data = pd.DataFrame({
    'A': [1, 2, np.nan, 4, 5],
    'B': [np.nan, 2, 3, np.nan, 5],
    'C': [1, 2, 3, 4, 5]
})

# 保存原始数据
original_data = data.copy()

# 显示缺失值情况
missing_info = data.isnull().sum()
print("缺失值情况：")
print(missing_info)

# # 以下为均值填充
# filled_data = data.fillna(data.mean())

#以下为knn（k近邻）填充
# 1. 创建填充器，n_neighbors=2 表示参考最近的两个邻居
imputer = KNNImputer(n_neighbors=2)

# 2. 填充数据。注意：KNNImputer 返回的是 Numpy 数组
filled_array = imputer.fit_transform(data)

# 3. 将数组转回 DataFrame 格式，并保持原有的列名
filled_data = pd.DataFrame(filled_array, columns=data.columns)

# 保存结果
filled_data.to_csv('C:/Users/Martin/Desktop/1.数据预处理笔记/1.缺失值处理_结果.csv', index=False)

# 设置中文显示
plt.rcParams['font.sans-serif'] = ['SimHei'] # 使用 Windows 自带的黑体
plt.rcParams['axes.unicode_minus'] = False# 解决负号 '-' 显示为方块的问题

# 可视化对比
fig, axes = plt.subplots(1, 2, figsize=(12, 5))

# 原始数据可视化
axes[0].set_title('原始数据')
axes[0].imshow(original_data.isnull(), cmap='gray', aspect='auto')
axes[0].set_xticks(range(original_data.shape[1]))
axes[0].set_xticklabels(original_data.columns)
axes[0].set_yticks(range(original_data.shape[0]))

# 处理后数据可视化
axes[1].set_title('均值填充后数据')
axes[1].imshow(filled_data.isnull(), cmap='gray', aspect='auto')
axes[1].set_xticks(range(filled_data.shape[1]))
axes[1].set_xticklabels(filled_data.columns)
axes[1].set_yticks(range(filled_data.shape[0]))

plt.tight_layout()
plt.savefig('C:/Users/Martin/Desktop/1.数据预处理笔记/案例结果/1.缺失值处理_对比图.png')
plt.close()

print("\n原始数据：")
print(original_data)
print("\n均值填充后数据：")
print(filled_data)
            </pre>
            </div>
        </div>

        <!-- 图像展示 -->
        <div class="card">
            <h2>四、 结果展示</h2>
            <div class="img-box">
                <img src="img/1.缺失值处理_对比图.png" alt="缺失值对比图">
                <p class="img-caption">程序导出的黑白缺失值分布对比图</p>
            </div>
            <div class="img-box">
                <img src="img/excel_sample.png" alt="CSV结果">
                <p class="img-caption">处理后的 CSV 文件预览</p>
            </div>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>